<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>音声録音と文字起こし (MP3)</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.0/lame.min.js"></script>
</head>
<body>
   <button id="startRecord">録音開始</button>
   <button id="stopRecord" disabled>録音停止</button>
   <p id="status">ステータス: 停止中</p>
   <div id="recordingsList">
       <h2>保存された録音</h2>
   </div>

   <script>
       const startRecordButton = document.getElementById('startRecord');
       const stopRecordButton = document.getElementById('stopRecord');
       const statusDisplay = document.getElementById('status');
       const recordingsList = document.getElementById('recordingsList');

       let mediaRecorder;
       let audioChunks = [];

       startRecordButton.addEventListener('click', async () => {
           try {
               const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
               console.log("マイクのストリームを取得しました:", stream);

               mediaRecorder = new MediaRecorder(stream);
               audioChunks = [];

               mediaRecorder.ondataavailable = event => {
                   audioChunks.push(event.data);
               };

               mediaRecorder.start();
               statusDisplay.textContent = "録音中...";
               startRecordButton.disabled = true;
               stopRecordButton.disabled = false;

               mediaRecorder.onstop = async () => {
                   const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                   const audioUrl = URL.createObjectURL(audioBlob);
                   saveRecording(audioUrl);
               };
           } catch (error) {
               console.error("マイクの取得エラー:", error);
           }
       });

       stopRecordButton.addEventListener('click', () => {
           mediaRecorder.stop();
           statusDisplay.textContent = "停止中";
           startRecordButton.disabled = false;
           stopRecordButton.disabled = true;
       });

       function saveRecording(audioUrl) {
           const recordingItem = document.createElement('div');
           const audio = document.createElement('audio');
           audio.src = audioUrl;
           audio.controls = true;

           const downloadLink = document.createElement('a');
           downloadLink.href = audioUrl;
           downloadLink.download = `recording_${Date.now()}.webm`;
           downloadLink.textContent = "録音をダウンロード";

           recordingItem.appendChild(audio);
           recordingItem.appendChild(downloadLink);
           recordingsList.appendChild(recordingItem);
       }
   </script>
</body>
</html>